# 신고 갤러리 개선
###### 개발2팀 박지훈
## **[(구)갤러리](http://gall.dcinside.com/list_pjh.php?id=singo '구갤')**
---
* 구갤러리 신고 게시판 수정.
*  대분류, 소분류 추가.
* 다중 관리 추가.
* '본문만보기' 레이어 추가.
* 댓글 매크로 변경.
* 차단 레이어 변경.
* 숨김, 차단 버튼 변경.
* 170830 주석

## 추가, 변경 부분
###1. 대분류, 소분류 추가
*  gallery_board_singo 에 f_category(대분류),  s_category(소분류) 컬럼 추가. 

*  skin/gallery/dc_singo/_top.php
	* singo Table-> conf_category 테이블에서 카테고리에 대한 정보를 SELECT.
	* 대분류는 A태그로 URL을 링크걸어 출력.
	* 소분류는 현재 대분류에 속해 있는 것들을 SELECT한 후 SELECT->OPTION태그로 출력.
*  gallery/list.php
	* $_GET 방식으로 f_c(f_category)와  s_c(s_category)를 받음.
	* f_c 가 없다면 기본적으로 f_c=1로 선언.
	* WHERE 조건문 변수인 \$s_query에 f_category = \$f_c, s_category = $s_c 를 추가.
	* singo게시판에서만 적용.($id=='singo')

###2.   다중관리 추가
* multi_report 테이블 추가

		* no - 고유번호
		* user_id - 로그인한 유저 아이디
		* login_time - 로그인 시간
		* logout_time - 로그아웃 시간
		* is_login - 로그인 여부
		* report_order - 관리 순서
* gallery/list.php
	* multi_report테이블에서 is_login=1인 유저를 체크하여 현재 다중관리 인원을 구함.
	* count(no)를 SELECT하여 로그인한 인원수를 구함.($multi_report_cnt)
	* 로그인한 아이디의 report_order값을 SELECT.($multi_report_user)
	* 조건문 변수 \$s_query에 "no%로그인한 인원수 = 관리 순서"를 추가함.( $s_query .= "no%".$multi_report_cnt[0]." = ".$multi_report_user['report_order'];)
* gallery/multi_report.php
	* 파라미터( id, mode ) 체크
	* 로그인 유효성 체크
		
			* 기존에 로그인 되어 있는지 체크.
			* 기존 로그인 인원이 4명 초과인지 체크(다중관리는 4명까지 지원).
			* 로그인한 유저가 관리자인지 체크.
	* 로그인 정보 Insert

			* is_loing = 1인 유저 SELECT.
			* while문으로 1~ 로그인 유저 수 까지 반복하여 비어 있는 관리 순서 체크.
			* 유저 아이디, 로그인 시간,  로그인 여부(1), 관리 순서 Insert.
	* 로그아웃 유효성 체크 - 유저아이디의 is_login 검사.
	* 로그 아웃 업데이트 - 로그아웃 시간, 로그인 여부(0), 관리 순서(0)
	* 기존 페이지로 이동.
###3.  '본문만 보기' 레이어 추가.
*  skin/gallery/dc_singo/_view.php
	* gallery_board_singo 테이블에  gall_id, gall_no 추가.(신고한 게시물의 id, no)
	* 본문 내용 뒤에 '본문만 보기' 버튼 추가
	*  javascript -> function layer_open(el) 추가
	* function laery_open(el)

			* gall_id와 gall_no를 사용하여 iframe의 url을 생성하여 js변수로 선언.
			* 본문만 보기 레이어 display->block 변경.
			* 레이어 내부에 iframe(id == singo_layer)이 없다면 iframe추가.
			
	*  페이지 최하단에 팝업레이어 추가.
* gallery/view_layer.php
	* 본문만 보기 iframe에서 호출하는 페이지.
	* 기존의 서브 기능들을 사용하려면 include해야하는 페이지가 많아 낭비가 심하여 본문보기, 차단, 숨김 기능만 제공
	* DB connect
		
			* $com_connect -> 갤러리 정보(gallery_admin_table)
			* $sep_connect -> 본문 내용 정보(gallery_board_id, gallery_info_id)
	*  파라미터
	
			* $view_data -> 본문 제목, 내용등 대다수의 데이터.
			* $recomm_data -> 본문 추천, 비추천
			* $bt_admin -> 관리자용 숨김, 차단 버튼 html
			
	* 차단을 위해 추가된 기존의 함수.

			* XMLHTTP() - XML통신 함수
			* setAvoid_new() - 차단 함수( _script_list.php->setAvoid() 함수 부분 변경 )
			* categoryChange() - 숨김 처리 함수
			* e.keycode==67(영어 c )에 keydown이벤트를 걸어 숨김처리 함.

###4. 댓글 매크로 변경.
* conf_macro 테이블 추가

		* cm_idx - 매크로 고유번호
		* cm_hotkey - 단축키
		* cm_title - 제목(신고 본문에서 표시될 내용)
		* cm_content - 댓글 내용(실제 댓글 남길 내용)
		* cm_alert_msg - 중복 신고시 보여주는 문구
		* cm_block - 댓글 작성 후 차단 유무
* skin/gallery/dc_singo/reple2.php
	* conf_macro 테이블에서 전체 macro 리스트를 가져와서 출력.
* skin/gallery/dc_singo/key_answer.php
	* cm_macro테이블에서 cm_hotkey 추출.
	* 각각의 hotkey에 "|"를 더하여 $hotkey_array에 저장.
	* $hotkey_array를 js변수 key_tmp 에 선언한 후 |로 분할.
	* 서브밋 함수에서 hidden:name=key의 value를 var key로 지정.
	* comment_ok.php 로 서브밋
* gallery/comment_ok.php
	* conf_macro테이블에서 cm_hotkey = $key 인 항목을 SELECT.
	* $memo를 SELECT한 항목의 cm_content로 지정.
	* cm_block이 1이면 dc_avoid_ip(common DB)에 Insert.
	* cm_alert_msg가 있으면 \$_InsertData에 추가.(\$_InsertData[alert_msg] = $hotkey_info['cm_alert_msg'];)




###5. 차단 레이어 변경
* skin/gallery/dc_singo/_list_new.php,    skin/gallery/skin_new/_list_new.php
	* 하단 차단 팝업의 HTML변경.
		* 차단 시간, 차단 사유 select-option태그 -> radio 태그로 변경.
		* 도배시간 주단위, 월단위 추가.
* gallery/inc/_script_list.php
	* 기존 차단함수 setAvoid()를 변경하여 setAvoid_new() 추가.
	* 신고 사유, 차단 시간이 radio태그로 바뀌어서 해당값 가져오는 변수 변경.
* gallery/avoid.php
	* 날짜 계산 추가

###6. 숨김, 차단 버튼 변경
* gallery/inc/_list_check.php
	* $bt_admin에 버튼 태그 지정.
	* 기존 C, I -> C(숨김), I(차단)으로 변경.
	* 신고게시판은 C, I를 키우지 않고 K만 키움.
	
###7. 기타
* gallery/inc/_list_check.php
	* 다중관리 로그인 상태면 대분류에 따라 게시물 제목 색상 변경.
	

---
## **[모바일웹](http://m.dcinside.com/singo/singo_new_category.php'모웹 신고')**


---
* 신고 버튼 변경
* 신고 카테고리 선택
* 신고 게시물, 내용, 이미지 작성, 업로드
* 중복 신고 체크
	
## 추가, 변경 부분
 
###1. 신고 버튼 변경
* common_new.js
	* 기존 신고 버튼 클릭 이벤트 제거.
	* 신고 버튼 누를 시 중복 신고 체크 singo_new_Overlap() 실행.
###2. 신고 카테고리 선택
* 대분류와 소분류는 추가/삭제 될 수 있음.
* 대분류

		* 게시물 신고
		* 서비스 신고
		* 서비스 신청
* 소분류
대분류 | 소분류
------|------
게시물 신고 | 광고
 　|도배
 　|음란물
 　|욕설
 　|개인정보침해
 　|저작권침해
서비스 신고|음란물
 　|HIT
 　|개념글
 　|갤러리 검색
 　|만두
 　|디시콘
 　|만두몰
서비스 신청|음란물
 　|대문
 　|자동 짤방
 　|공지
 　|매니저 위임
 